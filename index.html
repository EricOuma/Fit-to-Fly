<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!--Social meta tags-->
  <meta property=”og:type” content=”application” />
  <meta property=”og:title” content=”FIT TO INTERACT” />
  <meta property=”og:description” content=”FIT TO INTERACT” />
  <meta property=”og:image” content=”https://github.com/EricOuma/Fit-to-Fly-web” />
  <meta property=”og:url” content=”https://github.com/EricOuma/Fit-to-Fly-web” />
  <meta property=”og:site_name” content=”FIT TO INTERACT” />
  <meta name=”twitter:title” content=”FIT TO INTERACT”>
  <meta name=”twitter:description” content=”FIT TO INTERACT”>
  <meta name=”twitter:image” content=”https://github.com/EricOuma/Fit-to-Fly-web”>
  <meta name=”twitter:site” content=”@EricOuma”>
  <meta name=”twitter:creator” content=”@EricOuma”>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

  <!--MAIN CSS-->
  <link rel="stylesheet" href="css/styles.css">

  <!--Font Awesome-->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">

  <!--Animation-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" />

  <title>Fit to Interact</title>
</head>

<body>
  <div class="container">
    <div id="header" class="col-12 d-flex justify-content-center">
      <img src="img/logo.png" class="site-logo img-fluid pt-4" height="90" width="90" alt="Site Logo" />
    </div>
    <div id="main-section" class="main-section w-100 text-center p-4">
    <span>(Click anywhere to start)</span>
    <!--<h5 id="disclaimer">DISCLAIMER: This web app is experimental</h5>-->
      <h4 id="speak-this">Are you fit to interact? Let's find out.</h4>
      <i id="microphone" class="fas fa-microphone p-5"></i>
      <audio id="player"></audio>
      <h4 id="say-hello" class="invisible">Am listening. Say "Hello"...</h4>
      <p id="diagnostic"></p>
    </div>
  </div>


  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script>
    $(function() {
    
    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    const body = document.body;
     //------SPEECH SYNTHESIS---------------------

      body.onclick = function() {
          var synth = window.speechSynthesis;
          var disclaimer = document.querySelector('#disclaimer');
          var getStarted = document.querySelector('#speak-this');
          var voices = [];
          voices = synth.getVoices();
          //var utterThisOne = new SpeechSynthesisUtterance(disclaimer.innerText);
          var utterThisTwo = new SpeechSynthesisUtterance(getStarted.innerText);
  
          //utterThisOne.voice = voices[2];
  
          //utterThisOne.pitch = 1;
          //utterThisOne.rate = 1;
          //synth.speak(utterThisOne);
          
          utterThisTwo.voice = voices[2];
          utterThisTwo.pitch = 1;
          utterThisTwo.rate = 1;
          synth.speak(utterThisTwo);
          sleep(5000).then(() => { recognitionSpeech(); });
          }

      //----------------------SPEECH RECOGNITION---------------------
      function recognitionSpeech() {
          var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
          var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList
          var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent
    
          var greetings = ['Hello', 'Hi'];
          var grammar = '#JSGF V1.0; grammar greetings; public <greeting> = ' + greetings.join(' | ') + ' ;'
    
          var recognition = new SpeechRecognition();
          var speechRecognitionList = new SpeechGrammarList();
    
          speechRecognitionList.addFromString(grammar, 1);
    
          recognition.grammars = speechRecognitionList;
          recognition.continuous = false;
          recognition.lang = 'en-US';
          recognition.interimResults = false;
          recognition.maxAlternatives = 1;
    
          const sayHello = document.getElementById('say-hello')
          const diagnostic = document.getElementById('diagnostic')
          recognition.start();
          recognition.onstart = function() {
            console.log('Speech recognition service has started');
            const microphone = document.getElementById('microphone')
            microphone.classList.add("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")
    
            sayHello.classList.remove('invisible')
            sayHello.classList.add("animate__animated", "animate__zoomIn", "animate__delay-2s")
          }

          recognition.onspeechend = function() {
            recognition.stop();
            sayHello.classList.add('invisible')
            microphone.classList.remove("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")
            
          }
          recognition.onresult = function(event) {
            var greeting = event.results[0][0].transcript;
            console.log('You said: ' + greeting + '.');
            console.log('Confidence: ' + event.results[0][0].confidence);
            sleep(3000).then(() => { window.open("video-capture.html", "_self"); });
          }
          
          recognition.onnomatch = function(event) {
            diagnostic.textContent = 'I didnt recognise that.';
          }
          recognition.onerror = function(event) {
          sayHello.classList.add('invisible')
            diagnostic.textContent = 'Error occurred in recognition: ' + event.error;
            microphone.classList.remove("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")
          }
      };
    });
  </script>
</body>

</html>
