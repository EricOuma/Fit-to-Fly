<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!--Social meta tags-->
    <meta property=”og:type” content=”application”/>
    <meta property=”og:title” content=”FIT TO INTERACT”/>
    <meta property=”og:description” content=”FIT TO INTERACT”/>
    <meta property=”og:image” content=”https://github.com/EricOuma/Fit-to-Interact-web”/>
    <meta property=”og:url” content=”https://github.com/EricOuma/Fit-to-Interact-web”/>
    <meta property=”og:site_name” content=”FIT TO INTERACT”/>
    <meta name=”twitter:title” content=”FIT TO INTERACT”>
    <meta name=”twitter:description” content=”FIT TO INTERACT”>
    <meta name=”twitter:image” content=”https://github.com/EricOuma/Fit-to-Interact-web”>
    <meta name=”twitter:site” content=”@EricOuma”>
    <meta name=”twitter:creator” content=”@EricOuma”>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    
    <!--MAIN CSS-->
    <link rel="stylesheet" href="css/styles.css">
    
    <!--Font Awesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
    
    <!--Animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css"/>

    <title>Fit to Interact</title>
  </head>
  <body>
    <div class="container">
    <div id="header" class="col-12 d-flex justify-content-center">
     <img src="img/logo.png" class="site-logo img-fluid pt-4" height="90" width="90"  alt="Site Logo"/>
    </div>
    <div id="main-section" class="main-section w-100 text-center p-4">
    <p><span id="question-count"></span>&nbspof&nbsp<span id="total-questions"></span></p>
     <h2 id="question">Do you have a dry cough?</h2>
     <div class=""><i id="microphone" class="fas fa-microphone p-5"></i></div>
    <div class="answers d-flex justify-content-center p-2">
    <div class="yes bg-success p-4 rounded mr-5">YES</div>
    <div class="no bg-warning p-4 rounded ml-5">NO&nbsp</div>
    </div>
    <h3 id="diagnostic">...diagnostic</h3>
    </div>
    </div>
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script>
    $(function() {
    // NOTE EVERYONE WITH COVID19 IS SYMPTOMATIC
const questions = ["Do you have a cough", "Do you experience Fever or chills", "Do you experience shortness of breath or difficulty breathing", "Do you have muscle or body aches", "Do you have a sore throat", "Have you had close contact with someone diagnosed with COVID-19 or been notified that you may have been exposed to it"]

var responses = []


function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
//----------------------SPEECH RECOGNITION---------------------
var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList
var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent
    
var answers = ['Yes', 'No'];
var responded = false
var grammar = '#JSGF V1.0; grammar answers; public <answer> = ' + answers.join(' | ') + ' ;'
function recognitionSpeech() {
    var recognition = new SpeechRecognition();
    var speechRecognitionList = new SpeechGrammarList();
    
    speechRecognitionList.addFromString(grammar, 1);
    
    recognition.grammars = speechRecognitionList;
    recognition.continuous = false;
    recognition.lang = 'en-US';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;
    
    const diagnostic = document.getElementById('diagnostic')
    recognition.start();
    recognition.onstart = function() {
      console.log('Speech recognition service has started');
      const microphone = document.getElementById('microphone')
      microphone.classList.add("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")

    }

    recognition.onspeechend = function() {
      recognition.stop();
      microphone.classList.remove("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")
      
    }
    recognition.onresult = function(event) {
      var response = event.results[0][0].transcript;
      if(response != 'yes' || response != 'no') {
          diagnostic.textContent = "Kindly say 'YES' or 'NO'.";
          //recognitionSpeech();
      }
      responded = true;
      responses.push(response)
      diagnostic.textContent = 'You said: ' + response + '.';
      console.log('You said: ' + response + '.');
      console.log('Confidence: ' + event.results[0][0].confidence);
    }
    
    recognition.onnomatch = function(event) {
      diagnostic.textContent = 'I didnt recognise that.';
      //recognitionSpeech();
    }
    recognition.onerror = function(event) {
      diagnostic.textContent = 'Error occurred in recognition: ' + event.error;
      microphone.classList.remove("animate__animated", "animate__heartBeat", "animate__infinite", "infinite", "animate__delay-2s")
    }
};
//------------------------------------------------
const body = document.body;
 //------SPEECH SYNTHESIS---------------------

  body.onclick = () => {
      var synth = window.speechSynthesis;
      var inputTxt = document.querySelector('#question');
      var voices = [];
      voices = synth.getVoices();
      var utterThis = new SpeechSynthesisUtterance(inputTxt.innerText);
  
      utterThis.voice = voices[2];
  
      utterThis.pitch = 1;
      utterThis.rate = 0.9;
      synth.speak(utterThis);
      utterThis.onend = () => { recognitionSpeech()};

      //if(synth.pending == false && synth.speaking == false) {
      //console.log(synth.speaking)
          //sleep(1000).then(() => { recognitionSpeech(); });
      //}
      }
//-------SERIOUS QUESTIONING----------------
document.querySelector('#total-questions').innerText = questions.length;
(async function() {
for (let i = 0; i < questions.length; i++) {
 if(responded || i == 0) {
     document.querySelector('#question-count').innerText = i + 1;
     question.innerText = questions[i] + '?';
     responded = false;
 } else {
     //wait
 }
 while(responded == false) {
     await sleep(5000);
 }
}
console.log(responses)
sleep(3000).then(() => { window.open("thankyou.html", "_self"); });
})();
});
</script>
  </body>
</html>
